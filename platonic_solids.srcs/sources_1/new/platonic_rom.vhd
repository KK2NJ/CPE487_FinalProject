library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;
use work.graphics_pkg.all;

entity platonic_rom is
    port (
        solid_id   : in  unsigned(2 downto 0);  -- 0..4
        edge_index : in  unsigned(5 downto 0);  -- 0..29
        v0         : out vec3d;
        v1         : out vec3d;
        num_edges  : out unsigned(5 downto 0)   -- e.g. 6,12,12,30,30
    );
end entity;

architecture rtl of platonic_rom is
    constant MAX_V : integer := 20;
    constant MAX_E : integer := 30;

    type edge_pair is record
        a : integer range 0 to MAX_V-1;
        b : integer range 0 to MAX_V-1;
    end record;

    type vert_mem is array(0 to 4, 0 to MAX_V-1) of vec3d;
    type edge_mem is array(0 to 4, 0 to MAX_E-1) of edge_pair;
    type cnt_mem  is array(0 to 4) of integer range 0 to MAX_E;

    -- Helper "zero" vec
    constant VZ : vec3d := (x=>x"00000000", y=>x"00000000", z=>x"00000000");

    -- Vertices are Q16.16:
    --  1.0  = x"00010000"
    -- -1.0  = x"FFFF0000"
    --  phi  = x"00019E37"  (~1.6180339)
    -- 1/phi = x"00009E37"  (~0.6180339)

    constant VERTS : vert_mem := (
        -- 0) TETRA (4 vertices)
        0 => (
            0  => (x=>x"00010000", y=>x"00010000", z=>x"00010000"),
            1  => (x=>x"FFFF0000", y=>x"FFFF0000", z=>x"00010000"),
            2  => (x=>x"FFFF0000", y=>x"00010000", z=>x"FFFF0000"),
            3  => (x=>x"00010000", y=>x"FFFF0000", z=>x"FFFF0000"),
            4  => VZ, 5  => VZ, 6  => VZ, 7  => VZ, 8  => VZ, 9  => VZ,
            10 => VZ, 11 => VZ, 12 => VZ, 13 => VZ, 14 => VZ, 15 => VZ,
            16 => VZ, 17 => VZ, 18 => VZ, 19 => VZ
        ),

        -- 1) CUBE (8 vertices)
        1 => (
            0  => (x=>x"FFFF0000", y=>x"FFFF0000", z=>x"FFFF0000"),
            1  => (x=>x"FFFF0000", y=>x"FFFF0000", z=>x"00010000"),
            2  => (x=>x"FFFF0000", y=>x"00010000", z=>x"FFFF0000"),
            3  => (x=>x"FFFF0000", y=>x"00010000", z=>x"00010000"),
            4  => (x=>x"00010000", y=>x"FFFF0000", z=>x"FFFF0000"),
            5  => (x=>x"00010000", y=>x"FFFF0000", z=>x"00010000"),
            6  => (x=>x"00010000", y=>x"00010000", z=>x"FFFF0000"),
            7  => (x=>x"00010000", y=>x"00010000", z=>x"00010000"),
            8  => VZ, 9  => VZ, 10 => VZ, 11 => VZ, 12 => VZ, 13 => VZ,
            14 => VZ, 15 => VZ, 16 => VZ, 17 => VZ, 18 => VZ, 19 => VZ
        ),

        -- 2) OCTA (6 vertices)
        2 => (
            0  => (x=>x"00010000", y=>x"00000000", z=>x"00000000"),
            1  => (x=>x"FFFF0000", y=>x"00000000", z=>x"00000000"),
            2  => (x=>x"00000000", y=>x"00010000", z=>x"00000000"),
            3  => (x=>x"00000000", y=>x"FFFF0000", z=>x"00000000"),
            4  => (x=>x"00000000", y=>x"00000000", z=>x"00010000"),
            5  => (x=>x"00000000", y=>x"00000000", z=>x"FFFF0000"),
            6  => VZ, 7  => VZ, 8  => VZ, 9  => VZ, 10 => VZ, 11 => VZ,
            12 => VZ, 13 => VZ, 14 => VZ, 15 => VZ, 16 => VZ, 17 => VZ,
            18 => VZ, 19 => VZ
        ),

        -- 3) DODECA (20 vertices)
        3 => (
            0  => (x=>x"FFFF0000", y=>x"FFFF0000", z=>x"FFFF0000"),
            1  => (x=>x"FFFF0000", y=>x"FFFF0000", z=>x"00010000"),
            2  => (x=>x"FFFF0000", y=>x"00010000", z=>x"FFFF0000"),
            3  => (x=>x"FFFF0000", y=>x"00010000", z=>x"00010000"),
            4  => (x=>x"00010000", y=>x"FFFF0000", z=>x"FFFF0000"),
            5  => (x=>x"00010000", y=>x"FFFF0000", z=>x"00010000"),
            6  => (x=>x"00010000", y=>x"00010000", z=>x"FFFF0000"),
            7  => (x=>x"00010000", y=>x"00010000", z=>x"00010000"),

            8  => (x=>x"00000000", y=>x"FFFF61C9", z=>x"FFFE61C9"), -- (0, -1/phi, -phi)
            9  => (x=>x"00000000", y=>x"FFFF61C9", z=>x"00019E37"), -- (0, -1/phi, +phi)
            10 => (x=>x"00000000", y=>x"00009E37", z=>x"FFFE61C9"), -- (0, +1/phi, -phi)
            11 => (x=>x"00000000", y=>x"00009E37", z=>x"00019E37"), -- (0, +1/phi, +phi)

            12 => (x=>x"FFFF61C9", y=>x"FFFE61C9", z=>x"00000000"), -- (-1/phi, -phi, 0)
            13 => (x=>x"FFFF61C9", y=>x"00019E37", z=>x"00000000"), -- (-1/phi, +phi, 0)
            14 => (x=>x"00009E37", y=>x"FFFE61C9", z=>x"00000000"), -- (+1/phi, -phi, 0)
            15 => (x=>x"00009E37", y=>x"00019E37", z=>x"00000000"), -- (+1/phi, +phi, 0)

            16 => (x=>x"FFFE61C9", y=>x"00000000", z=>x"FFFF61C9"), -- (-phi, 0, -1/phi)
            17 => (x=>x"FFFE61C9", y=>x"00000000", z=>x"00009E37"), -- (-phi, 0, +1/phi)
            18 => (x=>x"00019E37", y=>x"00000000", z=>x"FFFF61C9"), -- (+phi, 0, -1/phi)
            19 => (x=>x"00019E37", y=>x"00000000", z=>x"00009E37")  -- (+phi, 0, +1/phi)
        ),

        -- 4) ICOSA (12 vertices)
        4 => (
            0  => (x=>x"00000000", y=>x"00010000", z=>x"00019E37"),
            1  => (x=>x"00000000", y=>x"FFFF0000", z=>x"00019E37"),
            2  => (x=>x"00000000", y=>x"00010000", z=>x"FFFE61C9"),
            3  => (x=>x"00000000", y=>x"FFFF0000", z=>x"FFFE61C9"),
            4  => (x=>x"00010000", y=>x"00019E37", z=>x"00000000"),
            5  => (x=>x"FFFF0000", y=>x"00019E37", z=>x"00000000"),
            6  => (x=>x"00010000", y=>x"FFFE61C9", z=>x"00000000"),
            7  => (x=>x"FFFF0000", y=>x"FFFE61C9", z=>x"00000000"),
            8  => (x=>x"00019E37", y=>x"00000000", z=>x"00010000"),
            9  => (x=>x"FFFE61C9", y=>x"00000000", z=>x"00010000"),
            10 => (x=>x"00019E37", y=>x"00000000", z=>x"FFFF0000"),
            11 => (x=>x"FFFE61C9", y=>x"00000000", z=>x"FFFF0000"),
            12 => VZ, 13 => VZ, 14 => VZ, 15 => VZ, 16 => VZ, 17 => VZ,
            18 => VZ, 19 => VZ
        )
    );

    constant EDGES : edge_mem := (
        -- 0) TETRA (6 edges)
        0 => (
            0  => (a=>0, b=>1),
            1  => (a=>0, b=>2),
            2  => (a=>0, b=>3),
            3  => (a=>1, b=>2),
            4  => (a=>1, b=>3),
            5  => (a=>2, b=>3),
            6  => (a=>0, b=>0), 7  => (a=>0, b=>0), 8  => (a=>0, b=>0), 9  => (a=>0, b=>0),
            10 => (a=>0, b=>0), 11 => (a=>0, b=>0), 12 => (a=>0, b=>0), 13 => (a=>0, b=>0),
            14 => (a=>0, b=>0), 15 => (a=>0, b=>0), 16 => (a=>0, b=>0), 17 => (a=>0, b=>0),
            18 => (a=>0, b=>0), 19 => (a=>0, b=>0), 20 => (a=>0, b=>0), 21 => (a=>0, b=>0),
            22 => (a=>0, b=>0), 23 => (a=>0, b=>0), 24 => (a=>0, b=>0), 25 => (a=>0, b=>0),
            26 => (a=>0, b=>0), 27 => (a=>0, b=>0), 28 => (a=>0, b=>0), 29 => (a=>0, b=>0)
        ),

        -- 1) CUBE (12 edges)
        1 => (
            0  => (a=>0, b=>1),
            1  => (a=>0, b=>2),
            2  => (a=>0, b=>4),
            3  => (a=>1, b=>3),
            4  => (a=>1, b=>5),
            5  => (a=>2, b=>3),
            6  => (a=>2, b=>6),
            7  => (a=>3, b=>7),
            8  => (a=>4, b=>5),
            9  => (a=>4, b=>6),
            10 => (a=>5, b=>7),
            11 => (a=>6, b=>7),
            12 => (a=>0, b=>0), 13 => (a=>0, b=>0), 14 => (a=>0, b=>0), 15 => (a=>0, b=>0),
            16 => (a=>0, b=>0), 17 => (a=>0, b=>0), 18 => (a=>0, b=>0), 19 => (a=>0, b=>0),
            20 => (a=>0, b=>0), 21 => (a=>0, b=>0), 22 => (a=>0, b=>0), 23 => (a=>0, b=>0),
            24 => (a=>0, b=>0), 25 => (a=>0, b=>0), 26 => (a=>0, b=>0), 27 => (a=>0, b=>0),
            28 => (a=>0, b=>0), 29 => (a=>0, b=>0)
        ),

        -- 2) OCTA (12 edges)
        2 => (
            0  => (a=>0, b=>2),
            1  => (a=>0, b=>3),
            2  => (a=>0, b=>4),
            3  => (a=>0, b=>5),
            4  => (a=>1, b=>2),
            5  => (a=>1, b=>3),
            6  => (a=>1, b=>4),
            7  => (a=>1, b=>5),
            8  => (a=>2, b=>4),
            9  => (a=>2, b=>5),
            10 => (a=>3, b=>4),
            11 => (a=>3, b=>5),
            12 => (a=>0, b=>0), 13 => (a=>0, b=>0), 14 => (a=>0, b=>0), 15 => (a=>0, b=>0),
            16 => (a=>0, b=>0), 17 => (a=>0, b=>0), 18 => (a=>0, b=>0), 19 => (a=>0, b=>0),
            20 => (a=>0, b=>0), 21 => (a=>0, b=>0), 22 => (a=>0, b=>0), 23 => (a=>0, b=>0),
            24 => (a=>0, b=>0), 25 => (a=>0, b=>0), 26 => (a=>0, b=>0), 27 => (a=>0, b=>0),
            28 => (a=>0, b=>0), 29 => (a=>0, b=>0)
        ),

        -- 3) DODECA (30 edges)  (computed by min-distance adjacency)
        3 => (
            0  => (a=>0, b=>8),
            1  => (a=>0, b=>10),
            2  => (a=>0, b=>12),
            3  => (a=>1, b=>9),
            4  => (a=>1, b=>11),
            5  => (a=>1, b=>12),
            6  => (a=>2, b=>8),
            7  => (a=>2, b=>10),
            8  => (a=>2, b=>13),
            9  => (a=>3, b=>9),
            10 => (a=>3, b=>11),
            11 => (a=>3, b=>13),
            12 => (a=>4, b=>8),
            13 => (a=>4, b=>10),
            14 => (a=>4, b=>14),
            15 => (a=>5, b=>9),
            16 => (a=>5, b=>11),
            17 => (a=>5, b=>14),
            18 => (a=>6, b=>8),
            19 => (a=>6, b=>10),
            20 => (a=>6, b=>15),
            21 => (a=>7, b=>9),
            22 => (a=>7, b=>11),
            23 => (a=>7, b=>15),
            24 => (a=>12, b=>16),
            25 => (a=>12, b=>17),
            26 => (a=>13, b=>16),
            27 => (a=>13, b=>17),
            28 => (a=>14, b=>18),
            29 => (a=>14, b=>19)
        ),

        -- 4) ICOSA (30 edges) (computed by min-distance adjacency)
        4 => (
            0  => (a=>0, b=>1),
            1  => (a=>0, b=>4),
            2  => (a=>0, b=>5),
            3  => (a=>0, b=>8),
            4  => (a=>0, b=>9),
            5  => (a=>1, b=>6),
            6  => (a=>1, b=>7),
            7  => (a=>1, b=>8),
            8  => (a=>1, b=>9),
            9  => (a=>2, b=>3),
            10 => (a=>2, b=>4),
            11 => (a=>2, b=>5),
            12 => (a=>2, b=>10),
            13 => (a=>2, b=>11),
            14 => (a=>3, b=>6),
            15 => (a=>3, b=>7),
            16 => (a=>3, b=>10),
            17 => (a=>3, b=>11),
            18 => (a=>4, b=>5),
            19 => (a=>4, b=>8),
            20 => (a=>4, b=>10),
            21 => (a=>5, b=>9),
            22 => (a=>5, b=>11),
            23 => (a=>6, b=>7),
            24 => (a=>6, b=>8),
            25 => (a=>6, b=>10),
            26 => (a=>7, b=>9),
            27 => (a=>7, b=>11),
            28 => (a=>8, b=>10),
            29 => (a=>9, b=>11)
        )
    );

    constant NUME : cnt_mem := (
        0 => 6,
        1 => 12,
        2 => 12,
        3 => 30,
        4 => 30
    );

begin
    process(all)
        variable sid : integer;
        variable ei  : integer;
        variable a_i : integer;
        variable b_i : integer;
    begin
        sid := to_integer(solid_id);
        if sid < 0 then sid := 0; end if;
        if sid > 4 then sid := 4; end if;

        ei := to_integer(edge_index);
        if ei < 0 then ei := 0; end if;
        if ei > (MAX_E-1) then ei := MAX_E-1; end if;

        num_edges <= to_unsigned(NUME(sid), 6);

        a_i := EDGES(sid, ei).a;
        b_i := EDGES(sid, ei).b;

        v0 <= VERTS(sid, a_i);
        v1 <= VERTS(sid, b_i);
    end process;
end architecture;
